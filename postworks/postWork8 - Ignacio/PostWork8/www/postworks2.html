<h1 id="postworks-bedu---data-science">Postworks Bedu - Data Science</h1>
<p>A lo largo del curso estuvimos trabajando con datos de los partidos de la liga española de fútbol en diferentes temporadas. Estos datasets contienen información como la fecha en la que se jugaron los partidos, los equipos que jugaron de casa y visitante, así como El número de goles anotados por el equipo de casa y el visitante en cada partido.</p>
<h1 id="primera-etapa">Primera Etapa</h1>
<p>A continuacion se muestra el procedimiento utilizado para cumplir con todos los puntos planteados dentro de los postworks.</p>
<h2 id="postwork-sesion-1">Postwork sesion 1</h2>
<p>Aprendimos a usar la función <code>read.csv</code> para importar y leer un archivo separado por comas. Con ayuda de la función table encontramos las probabilidades marginales y conjuntas de que los equipos de casa y visitante anotarán un número determinado de goles.</p>
<p>Importamos el data set de la liga de futbol española 2019-2020 usando la funcion read.csv() desde el URL.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>LigaEsp2019<span class="fl">.2020</span> <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://www.football-data.co.uk/mmz4281/1920/SP1.csv&quot;</span>)</span></code></pre></div>
<p>Los goles anotados por los equipos que jugaron en casa (FTHG) y los visitantes (FTAG)</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>goles.casa <span class="ot">&lt;-</span> <span class="fu">c</span>(LigaEsp2019<span class="fl">.2020</span><span class="sc">$</span>FTHG)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>goles.visitante <span class="ot">&lt;-</span> <span class="fu">c</span>(LigaEsp2019<span class="fl">.2020</span><span class="sc">$</span>FTAG)</span></code></pre></div>
<p>Tablas de frecuencia absoluta de goles de la casa, goles de visitantes y casa vs visitantes</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>frec.goles.casa <span class="ot">&lt;-</span> <span class="fu">table</span>(goles.casa)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>frec.goles.visitante <span class="ot">&lt;-</span> <span class="fu">table</span>(goles.visitante)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>frec.goles <span class="ot">&lt;-</span> <span class="fu">table</span>(goles.casa, goles.visitante)</span></code></pre></div>
<p>Tablas de frecuencia relativa de goles de la casa y goles de visitantes</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>frec.rel.goles.casa <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(<span class="at">x=</span>frec.goles.casa)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>frec.rel.goles.visitante <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(<span class="at">x=</span>frec.goles.visitante)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>goles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">6</span>,<span class="dv">1</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(frec.rel.goles.casa)) {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;La probabilidad marginal de que la casa anote&quot;</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>            i<span class="dv">-1</span>,<span class="st">&quot;goles es: &quot;</span>, frec.rel.goles.casa[i]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<blockquote>
<p>La probabilidad marginal de que la casa anote 0 goles es: 0.231578947368421</p>
<p>La probabilidad marginal de que la casa anote 1 goles es: 0.347368421052632</p>
<p>La probabilidad marginal de que la casa anote 2 goles es: 0.260526315789474</p>
<p>La probabilidad marginal de que la casa anote 3 goles es: 0.1</p>
<p>La probabilidad marginal de que la casa anote 4 goles es: 0.0368421052631579</p>
<p>La probabilidad marginal de que la casa anote 5 goles es: 0.0210526315789474</p>
<p>La probabilidad marginal de que la casa anote 6 goles es: 0.00263157894736842</p>
</blockquote>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(frec.rel.goles.visitante)) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;La probabilidad marginal de que el vistitante anote&quot;</span>,i,<span class="st">&quot;goles es: &quot;</span>, frec.rel.goles.visitante[i]))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<blockquote>
<p>La probabilidad marginal de que el vistitante anote 1 goles es: 0.357894736842105</p>
<p>La probabilidad marginal de que el vistitante anote 2 goles es: 0.352631578947368</p>
<p>La probabilidad marginal de que el vistitante anote 3 goles es: 0.213157894736842</p>
<p>La probabilidad marginal de que el vistitante anote 4 goles es: 0.0473684210526316</p>
<p>La probabilidad marginal de que el vistitante anote 5 goles es: 0.0236842105263158</p>
<p>La probabilidad marginal de que el vistitante anote 6 goles es: 0.00526315789473684</p>
</blockquote>
<p>Tabla de probabilidad conjunto de <code>x</code> goles del equipo de casa vs <code>y</code> goles del visitante</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;La probabilidad conjunta de que el equipo de casa anote &#39;x&#39; goles y el equivo visitante anote &#39;y&#39; goles estÃ¡ representada en la tabla:&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>(frec.rel.goles <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(frec.goles))</span></code></pre></div>
<blockquote>
<p>La probabilidad conjunta de que el equipo de casa anote ‘x’ goles y el equivo visitante anote ‘y’ goles estÃ¡ representada en la tabla:</p>
</blockquote>
<table>
<thead>
<tr class="header">
<th></th>
<th>goles.visitante</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>goles.casa</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
</tr>
<tr class="odd">
<td></td>
<td>0</td>
<td>0.086842105</td>
<td>0.073684211</td>
<td>0.039473684</td>
<td>0.021052632</td>
<td>0.005263158</td>
<td>0.005263158</td>
</tr>
<tr class="even">
<td></td>
<td>1</td>
<td>0.113157895</td>
<td>0.128947368</td>
<td>0.084210526</td>
<td>0.013157895</td>
<td>0.007894737</td>
<td>0.000000000</td>
</tr>
<tr class="odd">
<td></td>
<td>2</td>
<td>0.102631579</td>
<td>0.092105263</td>
<td>0.052631579</td>
<td>0.007894737</td>
<td>0.005263158</td>
<td>0.000000000</td>
</tr>
<tr class="even">
<td></td>
<td>3</td>
<td>0.036842105</td>
<td>0.036842105</td>
<td>0.018421053</td>
<td>0.005263158</td>
<td>0.002631579</td>
<td>0.000000000</td>
</tr>
<tr class="odd">
<td></td>
<td>4</td>
<td>0.010526316</td>
<td>0.013157895</td>
<td>0.010526316</td>
<td>0.000000000</td>
<td>0.002631579</td>
<td>0.000000000</td>
</tr>
<tr class="even">
<td></td>
<td>5</td>
<td>0.005263158</td>
<td>0.007894737</td>
<td>0.007894737</td>
<td>0.000000000</td>
<td>0.000000000</td>
<td>0.000000000</td>
</tr>
<tr class="odd">
<td></td>
<td>6</td>
<td>0.002631579</td>
<td>0.000000000</td>
<td>0.000000000</td>
<td>0.000000000</td>
<td>0.000000000</td>
<td>0.000000000</td>
</tr>
</tbody>
</table>
<h2 id="postwork-2">Postwork 2</h2>
<p>Aprendimos a aplicar la función <code>lapply</code> junto con <code>read.csv</code> para importar archivos desde una lista con las URLs, leer estos archivos y almacenarlos como data frames dentro de una lista. Con Mutate y as.Date le dimos el formato correcto a la columna de fechas de los partidos. Por último, con <code>do.call</code> y <code>rbind</code> unimos todos los data frames en un solo, y a este último lo guardamos en un archivo separado por comas con la función <code>write.csv</code>.</p>
<p>Creamos una lista con las direcciones donde se encuentran los archivos de futbol de las temporadas <code>2017/2018</code>, <code>2018/2019</code> y <code>2019/2020</code> de la primera división de la liga española</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>l.URLs <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;https://www.football-data.co.uk/mmz4281/1718/SP1.csv&quot;</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;https://www.football-data.co.uk/mmz4281/1819/SP1.csv&quot;</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;https://www.football-data.co.uk/mmz4281/1920/SP1.csv&quot;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Leemos los archivos desde las URLs y los guardamos como elementos DataFrame en una lista</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>lista_archivos <span class="ot">&lt;-</span> <span class="fu">lapply</span>(l.URLs, read.csv)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(lista_archivos)  <span class="co">#La lista contiene 3 elementos que son los 3 dataframes</span></span></code></pre></div>
<p>El elemento 1 de la lista contiene el dataframe con los datos de la temporada 2017-2018</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">data.frame</span>(lista_archivos[<span class="dv">1</span>]))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">data.frame</span>(lista_archivos[<span class="dv">1</span>]))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(<span class="fu">data.frame</span>(lista_archivos[<span class="dv">1</span>]))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">data.frame</span>(lista_archivos[<span class="dv">1</span>]))</span></code></pre></div>
<pre><code>Div     Date   HomeTeam   AwayTeam FTHG FTAG FTR HTHG HTAG HTR HS AS HST AST HF AF HC AC
1 SP1 18/08/17    Leganes     Alaves    1    0   H    1    0   H 16  6   9   3 14 18  4  2
2 SP1 18/08/17   Valencia Las Palmas    1    0   H    1    0   H 22  5   6   4 25 13  5  2
3 SP1 19/08/17      Celta   Sociedad    2    3   A    1    1   D 16 13   5   6 12 11  5  4
4 SP1 19/08/17     Girona Ath Madrid    2    2   D    2    0   H 13  9   6   3 15 15  6  0
5 SP1 19/08/17    Sevilla    Espanol    1    1   D    1    1   D  9  9   4   6 14 12  7  3
6 SP1 20/08/17 Ath Bilbao     Getafe    0    0   D    0    0   D 12  8   2   2 16 15  7  6
  HY AY HR AR B365H B365D B365A  BWH  BWD  BWA  IWH IWD  IWA  LBH  LBD  LBA  PSH  PSD  PSA
1  0  1  0  0  2.05  3.20  4.10 2.05 3.10 4.10 2.10 3.4 3.50 2.05 3.00 4.20 2.03 3.25 4.52
2  3  3  0  1  1.75  3.80  4.50 1.75 3.90 4.60 1.75 3.6 4.80 1.75 3.80 4.33 1.78 4.01 4.83
3  3  1  0  0  2.38  3.25  3.20 2.40 3.30 3.00 2.50 3.3 2.85 2.35 3.25 3.00 2.44 3.40 3.16
4  2  4  0  1  8.00  4.33  1.45 7.50 4.33 1.45 7.20 4.4 1.45 7.50 4.00 1.50 8.36 4.38 1.49
5  2  4  1  0  1.62  4.00  5.50 1.62 3.90 5.75 1.55 4.0 6.20 1.60 3.90 5.50 1.62 4.17 6.18
6  1  3  0  1  1.50  4.00  7.50 1.48 4.25 7.00 1.50 4.2 6.50 1.50 4.00 7.00 1.53 4.37 7.31
   WHH  WHD  WHA  VCH VCD  VCA Bb1X2 BbMxH BbAvH BbMxD BbAvD BbMxA BbAvA BbOU BbMx.2.5
1 2.05 3.10 4.00 2.05 3.2 4.40    35  2.12  2.03  3.40  3.15  4.52  4.17   31     2.84
2 1.80 3.75 4.20 1.80 4.0 4.60    35  1.83  1.77  4.04  3.86  4.83  4.46   33     1.69
3 2.40 3.40 2.90 2.40 3.4 3.13    35  2.50  2.39  3.50  3.32  3.20  3.01   34     2.03
4 8.00 4.20 1.44 7.50 4.3 1.50    35  8.36  7.53  4.40  4.17  1.51  1.48   34     2.20
5 1.67 3.60 5.50 1.65 4.0 5.75    35  1.69  1.63  4.17  3.93  6.20  5.58   33     1.81
6 1.50 4.00 7.00 1.50 4.2 7.00    34  1.53  1.50  4.40  4.17  7.50  6.94   32     2.01
  BbAv.2.5 BbMx.2.5.1 BbAv.2.5.1 BbAH BbAHh BbMxAHH BbAvAHH BbMxAHA BbAvAHA PSCH PSCD PSCA
1     2.68       1.53       1.46   18 -0.50    2.07    2.03    1.90    1.86 1.98 3.35 4.63
2     1.64       2.40       2.27   16 -0.75    2.05    1.97    1.96    1.91 1.78 4.24 4.43
3     1.98       1.90       1.84   18 -0.25    2.08    2.05    1.87    1.83 2.12 3.53 3.74
4     2.11       1.80       1.74   16  1.25    1.77    1.75    2.25    2.16 6.93 3.83 1.63
5     1.75       2.14       2.09   16 -1.00    2.12    2.06    1.86    1.82 1.64 4.18 5.82
6     1.94       1.96       1.87   17 -1.00    1.90    1.86    2.05    2.01 1.53 4.48 6.91</code></pre>
<p>El elemento 2 de la lista contiene el dataframe con los datos de la temporada 2018-2019</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">data.frame</span>(lista_archivos[<span class="dv">2</span>]))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">data.frame</span>(lista_archivos[<span class="dv">2</span>]))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(<span class="fu">data.frame</span>(lista_archivos[<span class="dv">2</span>]))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">data.frame</span>(lista_archivos[<span class="dv">2</span>]))</span></code></pre></div>
<pre><code>  Div       Date   HomeTeam   AwayTeam FTHG FTAG FTR HTHG HTAG HTR HS AS HST AST HF AF HC AC HY AY HR AR B365H B365D
1 SP1 17/08/2018      Betis    Levante    0    3   A    0    1   A 22  6   8   4 10 10  5  3  0  2  0  0  1.66  4.00
2 SP1 17/08/2018     Girona Valladolid    0    0   D    0    0   D 13  2   1   1 21 20  3  2  1  1  0  0  1.75  3.60
3 SP1 18/08/2018  Barcelona     Alaves    3    0   H    0    0   D 25  3   9   0  6 13  7  1  0  2  0  0  1.11 10.00
4 SP1 18/08/2018      Celta    Espanol    1    1   D    0    1   A 12 14   2   5 13 14  8  7  3  2  0  0  1.85  3.50
5 SP1 18/08/2018 Villarreal   Sociedad    1    2   A    1    1   D 16  8   7   4 16 10  4  6  2  3  0  0  2.04  3.40
6 SP1 19/08/2018      Eibar     Huesca    1    2   A    0    2   A 18  8   6   6 12 13  7  0  1  1  0  0  1.66  3.75
  B365A  BWH  BWD   BWA  IWH  IWD  IWA  PSH   PSD   PSA  WHH WHD   WHA  VCH  VCD  VCA Bb1X2 BbMxH BbAvH BbMxD BbAvD
1   5.0 1.70  3.7  5.25 1.75 3.60  4.9 1.69  4.19  5.11 1.67 3.9  4.75 1.67  4.2  5.2    40  1.75  1.68  4.25  4.00
2   5.0 1.75  3.5  5.25 1.80 3.60  4.5 1.80  3.70  4.99 1.75 3.6  4.60 1.80  3.7  4.8    40  1.85  1.78  3.83  3.60
3  21.0 1.11 10.0 20.00 1.12 9.00 20.0 1.11 11.27 25.40 1.08 9.0 29.00 1.10 10.5 34.0    40  1.13  1.10 11.50  9.82
4   4.5 1.91  3.4  4.25 1.90 3.50  4.1 1.93  3.64  4.27 1.91 3.5  4.00 1.93  3.5  4.4    38  1.97  1.90  3.73  3.53
5   3.8 2.05  3.3  3.90 2.00 3.40  3.8 2.06  3.51  3.91 2.05 3.3  3.60 2.05  3.5  3.9    40  2.11  2.03  3.62  3.43
6   5.5 1.70  3.7  5.25 1.70 3.75  5.0 1.72  3.90  5.26 1.73 3.6  4.75 1.70  3.8  5.0    40  1.76  1.70  3.93  3.77
  BbMxA BbAvA BbOU BbMx.2.5 BbAv.2.5 BbMx.2.5.1 BbAv.2.5.1 BbAH BbAHh BbMxAHH BbAvAHH BbMxAHA BbAvAHA PSCH  PSCD  PSCA
1  5.25  4.95   38     1.82     1.76       2.15       2.06   20 -0.75    1.89    1.85    2.07    2.00 1.59  4.42  5.89
2  5.27  4.79   38     2.21     2.13       1.78       1.71   20 -0.75    2.06    2.01    1.90    1.85 1.76  3.57  5.62
3 41.00 25.67   32     1.39     1.34       3.40       3.18   19 -2.50    1.95    1.91    2.00    1.95 1.10 11.85 32.17
4  4.50  4.20   36     2.13     2.06       1.84       1.76   18 -0.75    2.26    2.18    1.74    1.71 2.18  3.26  3.85
5  3.93  3.76   37     2.05     1.99       1.88       1.81   18 -0.25    1.76    1.74    2.23    2.14 2.32  3.21  3.53
6  5.50  5.08   37     1.95     1.88       1.98       1.91   19 -0.75    1.96    1.91    2.01    1.94 1.77  3.68  5.32</code></pre>
<p>El elemento 3 de la lista contiene el dataframe con los datos de la temporada 2019-2020</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">data.frame</span>(lista_archivos[<span class="dv">3</span>]))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">data.frame</span>(lista_archivos[<span class="dv">3</span>]))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(<span class="fu">data.frame</span>(lista_archivos[<span class="dv">3</span>]))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">data.frame</span>(lista_archivos[<span class="dv">3</span>]))</span></code></pre></div>
<pre><code>  Div       Date  Time   HomeTeam    AwayTeam FTHG FTAG FTR HTHG HTAG HTR HS AS HST AST HF AF HC AC HY AY HR AR B365H
1 SP1 16/08/2019 20:00 Ath Bilbao   Barcelona    1    0   H    0    0   D 11 11   5   2 14  9  3  8  1  1  0  0  5.25
2 SP1 17/08/2019 16:00      Celta Real Madrid    1    3   A    0    1   A  7 17   4  11 17 12  6  4  5  2  0  1  4.75
3 SP1 17/08/2019 18:00   Valencia    Sociedad    1    1   D    0    0   D 14 12   6   3 13 14  3  3  4  4  1  0  1.66
4 SP1 17/08/2019 19:00   Mallorca       Eibar    2    1   H    1    0   H 16 11   4   5 13 14  9  3  2  3  0  0  2.80
5 SP1 17/08/2019 20:00    Leganes     Osasuna    0    1   A    0    0   D 13  4   2   2 17 11  8  0  1  4  1  0  2.00
6 SP1 17/08/2019 20:00 Villarreal     Granada    4    4   D    1    1   D 12 14   7   7 10 16  2  7  3  1  0  0  1.60
  B365D B365A  BWH  BWD  BWA  IWH  IWD  IWA  PSH  PSD  PSA  WHH WHD  WHA  VCH  VCD  VCA MaxH MaxD MaxA AvgH AvgD AvgA
1  3.80  1.65 5.50 3.80 1.65 5.00 3.80 1.70 5.15 3.84 1.74 5.00 3.8 1.70 5.00 3.80 1.75 5.50 3.95 1.76 5.07 3.81 1.71
2  4.20  1.65 4.40 4.20 1.72 5.30 4.20 1.60 4.73 4.18 1.72 5.25 4.2 1.60 4.75 4.20 1.73 5.30 4.40 1.73 4.67 4.12 1.69
3  3.75  5.50 1.67 3.75 5.50 1.67 3.75 5.30 1.68 3.94 5.47 1.67 3.8 5.25 1.67 3.90 5.75 1.72 3.98 5.75 1.68 3.80 5.29
4  3.20  2.60 2.95 3.10 2.60 2.90 3.10 2.60 2.98 3.14 2.66 2.90 3.1 2.62 2.90 3.13 2.70 3.05 3.20 2.70 2.91 3.09 2.62
5  3.20  4.20 2.05 3.25 3.90 2.05 3.10 4.05 2.10 3.21 4.13 2.05 3.2 4.00 2.10 3.20 4.10 2.10 3.30 4.25 2.06 3.18 4.02
6  3.80  6.50 1.60 3.80 6.25 1.63 4.00 5.50 1.62 3.99 6.13 1.60 3.9 5.80 1.65 4.00 5.75 1.65 4.15 6.50 1.61 3.95 5.80
  B365.2.5 B365.2.5.1 P.2.5 P.2.5.1 Max.2.5 Max.2.5.1 Avg.2.5 Avg.2.5.1   AHh B365AHH B365AHA PAHH PAHA MaxAHH MaxAHA
1     1.80       2.00  1.81    2.09    1.85      2.11    1.79      2.05  0.75    1.99    1.94 1.98 1.94   2.00   1.95
2     1.53       2.50  1.52    2.66    1.53      2.72    1.49      2.58  0.75    2.04    1.89 2.01 1.91   2.05   1.91
3     2.00       1.80  2.08    1.82    2.14      1.83    2.07      1.77 -0.75    1.91    2.02 1.91 2.01   1.93   2.03
4     2.30       1.61  2.45    1.60    2.47      1.65    2.34      1.60  0.00    2.05    1.88 2.07 1.85   2.07   1.88
5     2.50       1.53  2.72    1.50    2.75      1.54    2.59      1.49 -0.50    2.08    1.85 2.10 1.82   2.10   1.85
6     1.80       2.00  1.88    2.02    1.90      2.05    1.84      1.98 -1.00    2.05    1.75 2.11 1.81   2.14   1.85
  AvgAHH AvgAHA B365CH B365CD B365CA BWCH BWCD BWCA IWCH IWCD IWCA PSCH PSCD PSCA WHCH WHCD WHCA VCCH VCCD VCCA MaxCH
1   1.96   1.92   5.25   3.80   1.65 4.75 3.75 1.75 5.00 3.80 1.70 5.34 3.62 1.78 5.00  3.8 1.70 4.80 3.80 1.80  5.80
2   2.00   1.88   5.25   4.20   1.57 4.50 4.10 1.70 4.60 3.80 1.75 5.10 4.46 1.65 5.00  4.2 1.63 5.20 4.40 1.65  6.00
3   1.89   1.99   1.66   3.75   5.50 1.65 3.80 5.50 1.67 3.80 5.30 1.69 3.88 5.47 1.65  3.9 5.25 1.70 3.90 5.50  1.72
4   2.04   1.85   2.87   3.20   2.55 2.95 3.10 2.60 2.90 3.10 2.60 2.96 3.26 2.60 2.90  3.1 2.60 3.00 3.13 2.63  3.05
5   2.06   1.83   1.90   3.10   5.00 1.95 3.20 4.50 1.90 3.15 4.85 1.90 3.18 5.30 2.05  3.2 4.00 1.90 3.20 5.20  1.95
6   2.07   1.80   1.53   4.00   6.50 1.57 3.80 6.50 1.55 4.05 6.30 1.54 4.19 6.87 1.62  3.9 5.80 1.57 4.00 7.00  1.58
  MaxCD MaxCA AvgCH AvgCD AvgCA B365C.2.5 B365C.2.5.1 PC.2.5 PC.2.5.1 MaxC.2.5 MaxC.2.5.1 AvgC.2.5 AvgC.2.5.1  AHCh
1  3.90  1.81  5.03  3.66  1.76      1.90        1.90   1.98     1.93     1.99       2.11     1.86       1.97  0.75
2  4.52  1.75  4.93  4.26  1.65      1.44        2.75   1.49     2.76     1.51       2.88     1.47       2.63  1.00
3  3.95  6.20  1.68  3.82  5.37      2.00        1.80   2.06     1.85     2.08       1.98     2.00       1.82 -0.75
4  3.29  2.72  2.93  3.14  2.59      2.20        1.66   2.20     1.74     2.38       1.74     2.24       1.66  0.00
5  3.26  5.30  1.90  3.16  4.91      2.75        1.44   2.84     1.47     2.85       1.50     2.69       1.46 -0.50
6  4.20  7.30  1.54  4.05  6.66      1.90        1.90   1.95     1.95     1.98       2.10     1.90       1.92 -1.00
  B365CAHH B365CAHA PCAHH PCAHA MaxCAHH MaxCAHA AvgCAHH AvgCAHA
1     1.93     2.00  1.91  2.01    2.02    2.03    1.91    1.98
2     1.82     1.97  1.85  2.07    2.00    2.20    1.82    2.06
3     1.94     1.99  1.92  2.00    1.96    2.12    1.89    2.00
4     2.11     1.82  2.09  1.83    2.12    1.88    2.07    1.83
5     1.89     2.04  1.90  2.01    1.95    2.06    1.90    1.99
6     1.96     1.97  1.96  1.96    1.98    2.12    1.93    1.95</code></pre>
<p>Creo una lista con las columnas seleccionadas de cada dataframe</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>lista_columnas <span class="ot">&lt;-</span> <span class="fu">lapply</span>(lista_archivos, select, <span class="fu">c</span>(<span class="st">&quot;Date&quot;</span>, <span class="st">&quot;HomeTeam&quot;</span>, <span class="st">&quot;AwayTeam&quot;</span>, <span class="st">&quot;FTHG&quot;</span>, <span class="st">&quot;FTAG&quot;</span>, <span class="st">&quot;FTR&quot;</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(lista_columnas) <span class="co">#La lista contiene 3 elementos que son un dataframe de las columnas seleccionadas por cada temporada</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">data.frame</span>(lista_columnas[<span class="dv">1</span>]))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">data.frame</span>(lista_columnas[<span class="dv">2</span>]))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">data.frame</span>(lista_columnas[<span class="dv">3</span>]))</span></code></pre></div>
<pre><code>&gt; [1] 3

&gt; &#39;data.frame&#39;: 380 obs. of  6 variables:
 $ Date    : chr  &quot;18/08/17&quot; &quot;18/08/17&quot; &quot;19/08/17&quot; &quot;19/08/17&quot; ...
 $ HomeTeam: chr  &quot;Leganes&quot; &quot;Valencia&quot; &quot;Celta&quot; &quot;Girona&quot; ...
 $ AwayTeam: chr  &quot;Alaves&quot; &quot;Las Palmas&quot; &quot;Sociedad&quot; &quot;Ath Madrid&quot; ...
 $ FTHG    : int  1 1 2 2 1 0 2 0 1 0 ...
 $ FTAG    : int  0 0 3 2 1 0 0 3 0 1 ...
 $ FTR     : chr  &quot;H&quot; &quot;H&quot; &quot;A&quot; &quot;D&quot; ...

&gt; &#39;data.frame&#39;: 380 obs. of  6 variables:
 $ Date    : chr  &quot;17/08/2018&quot; &quot;17/08/2018&quot; &quot;18/08/2018&quot; &quot;18/08/2018&quot; ...
 $ HomeTeam: chr  &quot;Betis&quot; &quot;Girona&quot; &quot;Barcelona&quot; &quot;Celta&quot; ...
 $ AwayTeam: chr  &quot;Levante&quot; &quot;Valladolid&quot; &quot;Alaves&quot; &quot;Espanol&quot; ...
 $ FTHG    : int  0 0 3 1 1 1 2 1 2 1 ...
 $ FTAG    : int  3 0 0 1 2 2 0 4 1 1 ...
 $ FTR     : chr  &quot;A&quot; &quot;D&quot; &quot;H&quot; &quot;D&quot; ...</code></pre>
<p>La columa “Date” de los dataframes es de clase caracter. Debemos de cambiarla a clase Date El formato es diferente para cada dataframe</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tmp2017.<span class="fl">2018.</span>dfcols <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="fu">data.frame</span>(lista_columnas[<span class="dv">1</span>]), <span class="at">Date =</span> <span class="fu">as.Date</span>(Date, <span class="st">&quot;%d/%m/%y&quot;</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>tmp2018.<span class="fl">2019.</span>dfcols <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="fu">data.frame</span>(lista_columnas[<span class="dv">2</span>]), <span class="at">Date =</span> <span class="fu">as.Date</span>(Date, <span class="st">&quot;%d/%m/%Y&quot;</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>tmp2019.<span class="fl">2020.</span>dfcols <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="fu">data.frame</span>(lista_columnas[<span class="dv">3</span>]), <span class="at">Date =</span> <span class="fu">as.Date</span>(Date, <span class="st">&quot;%d/%m/%Y&quot;</span>))</span></code></pre></div>
<p>Ahora comprobamos que la columna “Date” sea clase Date.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(tmp2017.<span class="fl">2018.</span>dfcols<span class="sc">$</span>Date)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(tmp2018.<span class="fl">2019.</span>dfcols<span class="sc">$</span>Date)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(tmp2019.<span class="fl">2020.</span>dfcols<span class="sc">$</span>Date)</span></code></pre></div>
<p>Por ultimo unimos todos los dataframes en uno solo</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>lista_final <span class="ot">&lt;-</span> <span class="fu">list</span>(tmp2017.<span class="fl">2018.</span>dfcols,tmp2018.<span class="fl">2019.</span>dfcols,tmp2019.<span class="fl">2020.</span>dfcols)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df.todo.final <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, lista_final)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df.todo.final)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   1140 obs. of  6 variables:
 $ Date    : Date, format: &quot;2017-08-18&quot; &quot;2017-08-18&quot; &quot;2017-08-19&quot; &quot;2017-08-19&quot; ...
 $ HomeTeam: chr  &quot;Leganes&quot; &quot;Valencia&quot; &quot;Celta&quot; &quot;Girona&quot; ...
 $ AwayTeam: chr  &quot;Alaves&quot; &quot;Las Palmas&quot; &quot;Sociedad&quot; &quot;Ath Madrid&quot; ...
 $ FTHG    : int  1 1 2 2 1 0 2 0 1 0 ...
 $ FTAG    : int  0 0 3 2 1 0 0 3 0 1 ...
 $ FTR     : chr  &quot;H&quot; &quot;H&quot; &quot;A&quot; &quot;D&quot; ...</code></pre>
<p>Guardamos el dataframe final para usarlo en la sesion 3</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df.todo.final, <span class="at">file =</span> <span class="st">&quot;Fut.ligaEsp.Postwork2.csv&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>, <span class="at">col.names=</span><span class="cn">TRUE</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<h2 id="postwork-sesion-3">Postwork sesion 3</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<p>Importar y leer el archivo resultado del postwork 2; datos de la liga española de futbol</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Fut.ligaEsp <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/AngelicaDC/Postworks_BEDU/main/data/Fut.ligaEsp.Postwork2.csv&quot;</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Fut.ligaEsp)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   1140 obs. of  6 variables:
 $ Date    : chr  &quot;2017-08-18&quot; &quot;2017-08-18&quot; &quot;2017-08-19&quot; &quot;2017-08-19&quot; ...
 $ HomeTeam: chr  &quot;Leganes&quot; &quot;Valencia&quot; &quot;Celta&quot; &quot;Girona&quot; ...
 $ AwayTeam: chr  &quot;Alaves&quot; &quot;Las Palmas&quot; &quot;Sociedad&quot; &quot;Ath Madrid&quot; ...
 $ FTHG    : int  1 1 2 2 1 0 2 0 1 0 ...
 $ FTAG    : int  0 0 3 2 1 0 0 3 0 1 ...
 $ FTR     : chr  &quot;H&quot; &quot;H&quot; &quot;A&quot; &quot;D&quot; ...</code></pre>
<p>Goles anotados por los equipos que jugaron en casa (FTHG) y los visitantes (FTAG)</p>
<p>Encontrar la probabilidad marginal de que la casa anote <code>x</code> goles a partir de las frec. relativas</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Frec.abs.FTHG <span class="ot">&lt;-</span> <span class="fu">table</span>(Fut.ligaEsp<span class="sc">$</span>FTHG) <span class="co">#Frecuencias absolutas</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>pmarg.golesCasa <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(Frec.abs.FTHG) <span class="co">#Probabilidades marginales</span></span></code></pre></div>
<p>Encontrar la probabilidad marginal de que el visitante anote <code>y</code> goles a partir de las frec. relativas</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>Frec.abs.FTAG <span class="ot">&lt;-</span> <span class="fu">table</span>(Fut.ligaEsp<span class="sc">$</span>FTAG) <span class="co">#Frecuencias absolutas</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>pmarg.golesVisitante <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(Frec.abs.FTAG) <span class="co">#Probabilidades marginales</span></span></code></pre></div>
<p>Encontrar probabilidad conjunta de que la casa anote <code>x</code> goles y el visitante <code>y</code> goles</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>Frec.abs.ambos <span class="ot">&lt;-</span> <span class="fu">table</span>(Fut.ligaEsp<span class="sc">$</span>FTHG, Fut.ligaEsp<span class="sc">$</span>FTAG)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>prob.conjunta <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(Frec.abs.ambos) <span class="co">#Probabilidades conjunta</span></span></code></pre></div>
<p>Crear dataframes de probablidades para poder usar ggplot</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Casa</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>df.goles.casa <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pmarg.golesCasa)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>equipo <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="at">x =</span> <span class="st">&quot;casa&quot;</span>, <span class="dv">9</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>df.goles.casa <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df.goles.casa, equipo)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Visita</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>df.goles.visitante <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pmarg.golesVisitante)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>equipo <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="at">x =</span> <span class="st">&quot;visitante&quot;</span>, <span class="dv">7</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>df.goles.visitante <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df.goles.visitante, equipo)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Conjunta</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>df.prob.conjunta <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(prob.conjunta)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>df.prob.conjunta <span class="ot">&lt;-</span> <span class="fu">rename</span>(df.prob.conjunta, <span class="at">Goles_casa=</span>Var1, <span class="at">Goles_visitante=</span>Var2)</span></code></pre></div>
<p>Unir dataframes para hacer un grafico de barras que represente a ambos equipos</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df.goles.ambos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df.goles.casa, df.goles.visitante)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(df.goles.ambos<span class="sc">$</span>Freq)</span></code></pre></div>
<p>Graficar las probabilidades marginales de cada equipo</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df.goles.ambos <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>Var1, <span class="at">y=</span>Freq, <span class="at">fill =</span> equipo) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">position=</span><span class="st">&quot;dodge&quot;</span>, <span class="at">color=</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Probabilidad de anotar goles&quot;</span>) <span class="sc">+</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Probabilidad marginal&quot;</span>) <span class="sc">+</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Numero de goles&quot;</span>) <span class="sc">+</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="st">&quot;equipo&quot;</span>) <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">&quot;Equipo&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;#0a7c93&quot;</span>,<span class="st">&quot;#43cc68&quot;</span>)) <span class="sc">+</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span> (<span class="at">fill =</span> <span class="st">&#39;linen&#39;</span>),</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span> (<span class="at">fill =</span> <span class="st">&#39;tan&#39;</span>), </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>),</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span> , <span class="at">size =</span> <span class="dv">10</span>, <span class="at">hjust =</span> <span class="dv">1</span>), </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span> , <span class="at">size =</span> <span class="dv">10</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span> (<span class="at">fill =</span> <span class="st">&#39;linen&#39;</span>),</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span><span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>))</span></code></pre></div>
<p align="center">
<img src="https://github.com/AngelicaDC/Postworks_BEDU/blob/main/img/Prob-anot-goles.png?raw=true" />
</p>
<p>Graficar la probabilidad conjunta</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df.prob.conjunta <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Goles_casa, <span class="at">y =</span> Goles_visitante, <span class="at">fill =</span> Freq) <span class="sc">+</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>()<span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Probabilidad conjunta de goles anotados </span><span class="sc">\n</span><span class="st"> Casa vs Visitante&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">&quot;white&quot;</span>, <span class="at">high =</span> <span class="st">&quot;green4&quot;</span>, <span class="at">name=</span><span class="st">&quot;Probabilidad </span><span class="sc">\n</span><span class="st"> conjunta&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Goles de casa&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Goles de visitante&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dark</span>() <span class="sc">+</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span><span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span> , <span class="at">size =</span> <span class="dv">10</span>, <span class="at">hjust =</span> <span class="dv">1</span>), </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span> , <span class="at">size =</span> <span class="dv">10</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span> , <span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span> , <span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span> , <span class="at">size =</span> <span class="dv">10</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(<span class="fu">round</span>(Freq<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>), <span class="st">&quot;%&quot;</span>)))</span></code></pre></div>
<p align="center">
<img src="https://github.com/AngelicaDC/Postworks_BEDU/blob/main/img/prob-casa-vs-visit.png?raw=true" />
</p>
<h3 id="postwork-4">Postwork 4</h3>
<p>Importar y leer el archivo resultado del postwork 2; datos de la liga española de futbol</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>Fut.ligaEsp <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/AngelicaDC/Postworks_BEDU/main/data/Fut.ligaEsp.Postwork2.csv&quot;</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(Fut.ligaEsp)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(Fut.ligaEsp)</span></code></pre></div>
<pre><code>&gt; [1] 1140    6</code></pre>
<p>Encontrar la probabilidad marginal de que la casa anote <code>x</code> goles a partir de las frec. relativas</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>Frec.abs.FTH <span class="ot">&lt;-</span> <span class="fu">table</span>(Fut.ligaEsp<span class="sc">$</span>FTHG) <span class="co">#Frecuencias absolutas</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>(pmarg.golesCasa <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">prop.table</span>(Frec.abs.FTHG))) <span class="co">#Probabilidades marginales</span></span></code></pre></div>
<pre><code>          0           1           2           3           4           5           6           7           8 
0.232456140 0.327192982 0.266666667 0.112280702 0.035087719 0.019298246 0.005263158 0.000877193 0.000877193 </code></pre>
<p>Encontrar la probabilidad marginal de que el visitante anote <code>y</code> goles a partir de las frec. relativas</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>Frec.abs.FTAG <span class="ot">&lt;-</span> <span class="fu">table</span>(Fut.ligaEsp<span class="sc">$</span>FTAG) <span class="co">#Frecuencias absolutas</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>(pmarg.golesVisitante <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">prop.table</span>(Frec.abs.FTAG))) <span class="co">#Probabilidades marginales</span></span></code></pre></div>
<pre><code>          0           1           2           3           4           5           6 
0.351754386 0.340350877 0.212280702 0.054385965 0.028947368 0.009649123 0.002631579 </code></pre>
<p>Encontrar probabilidad conjunta de que la casa anote <code>x</code> goles y el visitante <code>y</code> goles</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>Frec.abs.ambos <span class="ot">&lt;-</span> <span class="fu">table</span>(Fut.ligaEsp<span class="sc">$</span>FTHG, Fut.ligaEsp<span class="sc">$</span>FTAG)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>(prob.conjunta <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(Frec.abs.ambos)) <span class="co">#Probabilidades conjunta</span></span></code></pre></div>
<pre><code>  
              0           1           2           3           4           5           6
  0 0.078070175 0.080701754 0.045614035 0.018421053 0.005263158 0.004385965 0.000000000
  1 0.115789474 0.114912281 0.068421053 0.017543860 0.008771930 0.001754386 0.000000000
  2 0.087719298 0.093859649 0.061403509 0.011403509 0.008771930 0.001754386 0.001754386
  3 0.044736842 0.032456140 0.024561404 0.006140351 0.001754386 0.001754386 0.000877193
  4 0.014035088 0.010526316 0.007017544 0.000000000 0.003508772 0.000000000 0.000000000
  5 0.008771930 0.005263158 0.004385965 0.000000000 0.000877193 0.000000000 0.000000000
  6 0.002631579 0.001754386 0.000000000 0.000877193 0.000000000 0.000000000 0.000000000
  7 0.000000000 0.000877193 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000
  8 0.000000000 0.000000000 0.000877193 0.000000000 0.000000000 0.000000000 0.000000000</code></pre>
<h4 id="obter-una-tabla-de-cocientes">Obter una tabla de cocientes</h4>
<p>Dividimos las probabilidades conjuntas por el producto de las probabilidades marginales correspondientes. Calculamos el producto de probabilidades marginales</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>produto.pmarginales <span class="ot">&lt;-</span> pmarg.golesCasa<span class="sc">%*%</span><span class="fu">t</span>(pmarg.golesVisitante)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>produto.pmarginales</span></code></pre></div>
<pre><code>                 0            1            2            3            4            5            6
 [1,] 0.0817674669 0.0791166513 0.0493459526 1.264235e-02 6.728994e-03 2.242998e-03 6.117267e-04
 [2,] 0.1150915666 0.1113604186 0.0694567559 1.779471e-02 9.471376e-03 3.157125e-03 8.610342e-04
 [3,] 0.0938011696 0.0907602339 0.0566081871 1.450292e-02 7.719298e-03 2.573099e-03 7.017544e-04
 [4,] 0.0394952293 0.0382148353 0.0238350262 6.106494e-03 3.250231e-03 1.083410e-03 2.954755e-04
 [5,] 0.0123422592 0.0119421360 0.0074484457 1.908279e-03 1.015697e-03 3.385657e-04 9.233610e-05
 [6,] 0.0067882425 0.0065681748 0.0040966451 1.049554e-03 5.586334e-04 1.862111e-04 5.078486e-05
 [7,] 0.0018513389 0.0017913204 0.0011172669 2.862419e-04 1.523546e-04 5.078486e-05 1.385042e-05
 [8,] 0.0003085565 0.0002985534 0.0001862111 4.770699e-05 2.539243e-05 8.464143e-06 2.308403e-06
 [9,] 0.0003085565 0.0002985534 0.0001862111 4.770699e-05 2.539243e-05 8.464143e-06 2.308403e-06</code></pre>
<p>Calculamos el cociente de la probabilidad conjunta sobre el producto de probabilidades marginales</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>(cociente <span class="ot">&lt;-</span> prob.conjunta<span class="sc">/</span>produto.pmarginales)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(cociente)</span></code></pre></div>
<pre><code>&gt;   
            0         1         2         3         4         5         6
  0 0.9547829 1.0200350 0.9243724 1.4570907 0.7821612 1.9554031 0.0000000
  1 1.0060639 1.0318952 0.9850885 0.9859033 0.9261516 0.5556910 0.0000000
  2 0.9351621 1.0341495 1.0847107 0.7862903 1.1363636 0.6818182 2.5000000
  3 1.1327151 0.8493073 1.0304752 1.0055444 0.5397727 1.6193182 2.9687500
  4 1.1371571 0.8814433 0.9421488 0.0000000 3.4545455 0.0000000 0.0000000
  5 1.2922240 0.8013121 1.0706236 0.0000000 1.5702479 0.0000000 0.0000000
  6 1.4214464 0.9793814 0.0000000 3.0645161 0.0000000 0.0000000 0.0000000
  7 0.0000000 2.9381443 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
  8 0.0000000 0.0000000 4.7107438 0.0000000 0.0000000 0.0000000 0.0000000

&gt; [1] 9 7</code></pre>
<h3 id="generación-de-boostrap-sobre-los-datos">Generación de boostrap sobre los datos</h3>
<p>Hacemos un bootstrap para generar datos y usamos replace para que se permitan valores repetidos</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df_hv<span class="ot">=</span> <span class="fu">paste</span>(Fut.ligaEsp<span class="sc">$</span>FTHG, Fut.ligaEsp<span class="sc">$</span>FTAG)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(df_hv)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>df_hv</span></code></pre></div>
<p><code>[1] "character"</code></p>
<pre><code>&gt; df_hv
   [1] &quot;1 0&quot; &quot;1 0&quot; &quot;2 3&quot; &quot;2 2&quot; &quot;1 1&quot; &quot;0 0&quot; &quot;2 0&quot; &quot;0 3&quot; &quot;1 0&quot; &quot;0 1&quot; &quot;2 1&quot; &quot;3 0&quot; &quot;0 2&quot;
...
 [989] &quot;2 1&quot; &quot;2 3&quot; &quot;2 2&quot; &quot;1 0&quot; &quot;2 1&quot; &quot;2 1&quot; &quot;2 1&quot; &quot;2 2&quot; &quot;0 0&quot; &quot;0 1&quot; &quot;2 2&quot; &quot;3 3&quot;
 [ reached getOption(&quot;max.print&quot;) -- omitted 140 entries ]</code></pre>
<p>Generamos 1000 muestras</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>bhv <span class="ot">=</span> <span class="fu">replicate</span>(<span class="at">n=</span><span class="dv">1000</span>, <span class="fu">sample</span>(df_hv, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">#bhv</span></span></code></pre></div>
<p>Se utiliza la siguiente funcion para empaquetar los resultados de los partidos.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>reformat <span class="ot">&lt;-</span> <span class="cf">function</span>(s) {</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">strsplit</span>(s, <span class="st">&#39; &#39;</span>), strtoi))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>ref<span class="ot">=</span><span class="fu">apply</span>(bhv, <span class="dv">1</span>, reformat)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(ref)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(bhv)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(ref)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th></th>
<th>v1</th>
<th>v2</th>
<th>v3</th>
<th>…</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td></td>
</tr>
<tr class="even">
<td>1</td>
<td>0</td>
<td>2</td>
<td>1</td>
<td></td>
</tr>
<tr class="odd">
<td>…</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<pre><code>&gt; class(bhv)
[1] &quot;matrix&quot; &quot;array&quot;
&gt; dim(ref)
[1] 2000 1140 </code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>nones <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">dim</span>(ref)[<span class="dv">1</span>],<span class="dv">2</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>pares <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="fu">dim</span>(ref)[<span class="dv">1</span>],<span class="dv">2</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>casa <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(ref[nones,])</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>casa <span class="ot">&lt;-</span> <span class="fu">t</span>(casa)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>visita <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(ref[pares,])</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>visita <span class="ot">&lt;-</span> <span class="fu">t</span>(visita)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(visita)</span></code></pre></div>
<pre><code>[1] 1140 1000</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>cocientes.list <span class="ot">&lt;-</span>  <span class="fu">list</span>()</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(visita)[<span class="dv">2</span>]) {</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  dfi <span class="ot">&lt;-</span> <span class="fu">cbind</span>(casa[,i],visita[,i])</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Sacamos frecuencias absolutas y probabilidades marginales</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  fabsH<span class="ot">=</span><span class="fu">table</span>(casa[,i])</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  pmargH <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">prop.table</span>(fabsH))</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  fabsV <span class="ot">&lt;-</span> <span class="fu">table</span>(visita[,i])</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  pmargV <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">prop.table</span>(fabsV))</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Sacamos la probabilidad conjunta</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  fabsCon <span class="ot">&lt;-</span> <span class="fu">table</span>(dfi[,<span class="dv">1</span>],dfi[,<span class="dv">2</span>])</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  pCon <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(fabsCon)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  prod.marg <span class="ot">&lt;-</span> pmargH<span class="sc">%*%</span><span class="fu">t</span>(pmargV)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  cociente.sample <span class="ot">&lt;-</span> pCon<span class="sc">/</span>prod.marg</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  cocientes.list[[i]] <span class="ot">&lt;-</span> cociente.sample</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>dataFrames <span class="ot">&lt;-</span> <span class="fu">lapply</span>(cocientes.list, as.data.frame)</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>SuperDataFrame <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(<span class="cf">function</span>(x, y) <span class="fu">merge</span>(x, y, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;Var1&quot;</span>,<span class="st">&quot;Var2&quot;</span>),<span class="at">all=</span><span class="cn">TRUE</span>), dataFrames)</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="co">#SuperDataFrame</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="co">#str(SuperDataFrame)</span></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>SuperDataFrame<span class="sc">$</span>Medias <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(SuperDataFrame[,<span class="dv">3</span><span class="sc">:</span><span class="dv">1002</span>],<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>SuperDataFrame<span class="sc">$</span>sd<span class="ot">&lt;-</span> <span class="fu">apply</span>(SuperDataFrame[,<span class="dv">3</span><span class="sc">:</span><span class="dv">1002</span>], <span class="dv">1</span>, sd,<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>SuperDataFrame<span class="sc">$</span>varianza <span class="ot">&lt;-</span> SuperDataFrame<span class="sc">$</span>sd<span class="sc">**</span><span class="dv">2</span></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>chiquito <span class="ot">&lt;-</span> <span class="fu">select</span>(SuperDataFrame,<span class="fu">c</span>(<span class="st">&quot;Var1&quot;</span>,<span class="st">&quot;Var2&quot;</span>,<span class="st">&quot;Medias&quot;</span>,<span class="st">&quot;varianza&quot;</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th>Var1</th>
<th>Var2</th>
<th>Medias</th>
<th>varianza</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>0</td>
<td>0.9599280</td>
</tr>
<tr class="even">
<td>2</td>
<td>0</td>
<td>1</td>
<td>1.0228705</td>
</tr>
<tr class="odd">
<td>3</td>
<td>0</td>
<td>2</td>
<td>0.9188134</td>
</tr>
<tr class="even">
<td>4</td>
<td>0</td>
<td>3</td>
<td>1.4293345</td>
</tr>
<tr class="odd">
<td>5</td>
<td>0</td>
<td>4</td>
<td>0.7862167</td>
</tr>
<tr class="even">
<td>6</td>
<td>0</td>
<td>5</td>
<td>1.9274841</td>
</tr>
<tr class="odd">
<td>7</td>
<td>0</td>
<td>6</td>
<td>0.0000000</td>
</tr>
<tr class="even">
<td>8</td>
<td>1</td>
<td>0</td>
<td>1.0035822</td>
</tr>
<tr class="odd">
<td>…</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Sacamos la media y la varianza para cada uno de los 63 cocientes</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>medias <span class="ot">&lt;-</span> chiquito<span class="sc">$</span>Medias</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>varianzas <span class="ot">&lt;-</span> chiquito<span class="sc">$</span>varianza</span></code></pre></div>
<p>Calculo estadistico de prueba para una muestra grande. ### H0: Mu=1 ### Ha: Mu!=1</p>
<p>Calculamos el estadistico de prueba para los valores de los cocientes. Usamos la varianza obtenida a partir de bootstrap</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>(z0 <span class="ot">&lt;-</span> (cociente<span class="dv">-1</span>)<span class="sc">/</span><span class="fu">sqrt</span>(varianzas<span class="sc">/</span><span class="dv">63</span>))</span></code></pre></div>
<pre><code>               0            1            2            3            4            5            6
  0   -4.9258122    1.9625216   -1.9882483    1.3016450   -6.1252698    2.4871799         -Inf
  1    0.6461230    1.4197815   -0.2444047   -0.5041213   -1.3401534         -Inf         -Inf
  2   -5.3560238    1.1025246    0.5704791   -8.0615523          Inf         -Inf          Inf
  3    4.0736408   -3.1726911    2.0874013    0.1490621   -2.2369492          Inf  125.6324130
  4    3.8039319         -Inf   -4.1437735         -Inf          Inf         -Inf         -Inf
  5    3.3601524  -23.6414712    3.3680419   -4.8515613          Inf         -Inf         -Inf
  6          Inf   -2.4196671  -23.0240719          Inf  -12.5952724  -29.4831256         -Inf
  7 -139.8780603  163.0327416  -20.6280892         -Inf  -12.9309968         -Inf         -Inf
  8 -139.5223199  -40.6748732   26.8321666  -25.4921159         -Inf         -Inf         -Inf</code></pre>
<p>Y para comparar, calculamos tambien el estadistico de prueba es uno para cada uno de los 63 cocientes del bootstrap.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>(z0b <span class="ot">&lt;-</span> (medias<span class="dv">-1</span>)<span class="sc">/</span><span class="fu">sqrt</span>(varianzas<span class="sc">/</span><span class="dv">63</span>))</span></code></pre></div>
<pre><code>[1]  -4.3653119   2.4368981  -6.7065292  13.1782642  -5.9290912  10.6647230        -Inf   0.5010683   4.4127669
[10]  -1.1337589  -0.6119235  -2.3102011  -8.9506204        -Inf  -7.9450568   4.0055249   7.1545604  -8.2024621
[19]   3.5408918  -5.3631169  10.2901826   9.1064689 -10.9231970   1.2442273   0.5624191  -9.2996982   4.6074413
[28]   5.4467680   5.0662579  -4.3754921  -1.4169223        -Inf  11.4956050        -Inf        -Inf   7.3778356
[37]  -5.9646361   1.6583225        -Inf   3.1620914        -Inf        -Inf   5.3639229  -0.3965892        -Inf
[46]   5.4524344        -Inf        -Inf        -Inf        -Inf        -Inf 109.3778437        -Inf        -Inf
[55]        -Inf        -Inf        -Inf 123.6901311        -Inf        -Inf        -Inf        -Inf        -Inf</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Reorganizamos z0b</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>z0b <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">matrix</span>(z0b, <span class="at">nrow =</span> <span class="dv">7</span>, <span class="at">ncol =</span> <span class="dv">9</span>))</span></code></pre></div>
<p>Encontrar region de rechazo para dos colas porque la hipotesis alternativa es <code>Mu!=1</code> Queremos que <code>alfa=0.1</code>. Dividimos <code>alfa/2=0.05</code>. Sacamos <code>z05</code> para ambas colas.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>(z.<span class="fl">025.</span>arriba <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="at">p =</span> <span class="fl">0.025</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)) <span class="co">#z0 tiene que ser mas alta que z.05.arriba </span></span></code></pre></div>
<blockquote>
<p>[1] 1.959964</p>
</blockquote>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>(z.<span class="fl">025.</span>abajo <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="at">p =</span> <span class="fl">0.025</span>, <span class="at">lower.tail =</span> <span class="cn">TRUE</span>)) <span class="co">#z0 tiene que ser mas baja que z.05.abajo</span></span></code></pre></div>
<blockquote>
<p>[1] -1.959964</p>
</blockquote>
<p>Comprobar o rechazar hipotesis nula de que los valores de los cocientes son iguales a 1. Region de rechazo de hipotesis nula <code>Z0 &gt; z.05.arriba</code> o <code>Z0 &lt; z.05.abajo</code>.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>(rechazo.cociente <span class="ot">&lt;-</span> (z0 <span class="sc">&gt;</span> z.<span class="fl">025.</span>arriba) <span class="sc">|</span> (z0 <span class="sc">&lt;</span> z.<span class="fl">025.</span>abajo)) <span class="co">#Los valores de la primer tabal cocientes tiene que ser mas baja que z.05.abajo </span></span></code></pre></div>
<pre><code>       0     1     2     3     4    5    6
  0  TRUE  TRUE  TRUE FALSE  TRUE TRUE TRUE
  1 FALSE FALSE FALSE FALSE FALSE TRUE TRUE
  2  TRUE FALSE FALSE  TRUE  TRUE TRUE TRUE
  3  TRUE  TRUE  TRUE FALSE  TRUE TRUE TRUE
  4  TRUE  TRUE  TRUE  TRUE  TRUE TRUE TRUE
  5  TRUE  TRUE  TRUE  TRUE  TRUE TRUE TRUE
  6  TRUE  TRUE  TRUE  TRUE  TRUE TRUE TRUE
  7  TRUE  TRUE  TRUE  TRUE  TRUE TRUE TRUE
  8  TRUE  TRUE  TRUE  TRUE  TRUE TRUE TRUE</code></pre>
<p>O mas grandes que <code>z.05.arriba</code></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>rechazo.samples <span class="ot">&lt;-</span> (z0b <span class="sc">&gt;</span> z.<span class="fl">025.</span>arriba) <span class="sc">|</span> (z0b <span class="sc">&lt;</span> z.<span class="fl">025.</span>abajo) <span class="co">#Comparamos con las medias del bootstrap</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(rechazo.samples) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>,<span class="st">&quot;3&quot;</span>,<span class="st">&quot;4&quot;</span>,<span class="st">&quot;5&quot;</span>,<span class="st">&quot;6&quot;</span>,<span class="st">&quot;7&quot;</span>,<span class="st">&quot;8&quot;</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rechazo.samples) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>,<span class="st">&quot;3&quot;</span>,<span class="st">&quot;4&quot;</span>,<span class="st">&quot;5&quot;</span>,<span class="st">&quot;6&quot;</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>rechazo.samples</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>1</td>
<td>FALSE</td>
<td>TRUE</td>
<td>FALSE</td>
<td>FALSE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>2</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>3</td>
<td>TRUE</td>
<td>TRUE</td>
<td>FALSE</td>
<td>FALSE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>4</td>
<td>TRUE</td>
<td>TRUE</td>
<td>FALSE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>5</td>
<td>TRUE</td>
<td>TRUE</td>
<td>FALSE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>6</td>
<td>TRUE</td>
<td>FALSE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>7</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>8</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>TRUE</td>
</tr>
</tbody>
</table>
<h3 id="los-valores-true-nos-indican-en-que-casos-se-rechaza-la-hipotesis-nula-es-decir-que-existe-una-dependencia-entre-las-variables-x-y-y">Los valores <code>TRUE</code> nos indican en que casos se rechaza la hipotesis nula, es decir que existe una dependencia entre las variables <code>x</code> y <code>y</code></h3>
<h3 id="los-valores-false-nos-indican-en-que-casos-que-no-se-rechaza-h0-es-decir-que-las-variables-x-y-y-son-independientes.">Los valores <code>FALSE</code> nos indican en que casos que no se rechaza <code>H0</code>, es decir que las variables <code>x</code> y <code>y</code> son independientes.</h3>
<h1 id="segunda-etapa">Segunda Etapa</h1>
<h2 id="postwork-7">Postwork 7</h2>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fbRanks)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;C:/Users/Ok/Documents/BEDU/R/postworks/&quot;</span>) <span class="co">#cambiar ubicación</span></span></code></pre></div>
<p>Creamos una lista con las direcciones donde se encuentran los archivos de futbol de las temporadas <code>2017/2018</code>, <code>2018/2019</code> y <code>2019/2020</code> de la primera división de la liga española.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>l.URLs <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;https://www.football-data.co.uk/mmz4281/1718/SP1.csv&quot;</span>,</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;https://www.football-data.co.uk/mmz4281/1819/SP1.csv&quot;</span>,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;https://www.football-data.co.uk/mmz4281/1920/SP1.csv&quot;</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>               )</span></code></pre></div>
<p>Leemos los archivos desde las URLs y los guardamos como elementos <code>DataFrame</code> en una lista.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>lista_archivos <span class="ot">&lt;-</span> <span class="fu">lapply</span>(l.URLs, read.csv)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Creo una lista con las columnas seleccionadas de cada dataframe</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>lista_columnas <span class="ot">&lt;-</span> <span class="fu">lapply</span>(lista_archivos, select, <span class="fu">c</span>(<span class="st">&quot;Date&quot;</span>,<span class="st">&quot;HomeTeam&quot;</span>,<span class="st">&quot;FTHG&quot;</span>,<span class="st">&quot;AwayTeam&quot;</span>,<span class="st">&quot;FTAG&quot;</span>))</span></code></pre></div>
<p>La columa <code>Date</code> de los dataframes es de clase caracter. Por lo tanto se procedio a cambiar a clase <code>Date</code> para poder trabajar.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#El formato es diferente para cada dataframe</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>tmp2017.<span class="fl">2018.</span>dfcols <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="fu">data.frame</span>(lista_columnas[<span class="dv">1</span>]), <span class="at">Date =</span> <span class="fu">as.Date</span>(Date, <span class="st">&quot;%d/%m/%y&quot;</span>))</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>tmp2018.<span class="fl">2019.</span>dfcols <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="fu">data.frame</span>(lista_columnas[<span class="dv">2</span>]), <span class="at">Date =</span> <span class="fu">as.Date</span>(Date, <span class="st">&quot;%d/%m/%Y&quot;</span>))</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>tmp2019.<span class="fl">2020.</span>dfcols <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="fu">data.frame</span>(lista_columnas[<span class="dv">3</span>]), <span class="at">Date =</span> <span class="fu">as.Date</span>(Date, <span class="st">&quot;%d/%m/%Y&quot;</span>))</span></code></pre></div>
<p>Creamos un solo dataframe que contenga la informacion de las tres temporadas y lo guardamos.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>lista_final <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    tmp2017.<span class="fl">2018.</span>dfcols,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    tmp2018.<span class="fl">2019.</span>dfcols,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    tmp2019.<span class="fl">2020.</span>dfcols</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>SmallData <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, lista_final)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>SmallData <span class="ot">&lt;-</span> <span class="fu">rename</span>(</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    SmallData, </span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">date=</span>Date, </span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">home.team=</span>HomeTeam, </span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">home.score=</span>FTHG, </span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">away.team=</span>AwayTeam, </span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">away.score=</span>FTAG</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(SmallData, <span class="at">file =</span> <span class="st">&quot;soccer.csv&quot;</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Importamos el <code>archivo soccer.csv</code> como un lista con dataframes a través de la función <code>create.fbRanks.dataframes</code>.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Le damos el formato de fecha</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>listasoccer <span class="ot">&lt;-</span> <span class="fu">create.fbRanks.dataframes</span>(</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;soccer.csv&quot;</span>, </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">date.format=</span><span class="st">&quot;%Y-%m-%d&quot;</span>, </span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.remove =</span> <span class="cn">FALSE</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Guardamos los dataframes de la lista en dataframes independientes</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>anotaciones <span class="ot">&lt;-</span> listasoccer<span class="sc">$</span>scores</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>equipos <span class="ot">&lt;-</span> listasoccer<span class="sc">$</span>teams</span></code></pre></div>
<p>Extraemos los valores únicos de fechas. Usando str(anotaciones) nos damos cuenta que date está guardada como una columna de anotaciones</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>fecha <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">unique</span>(anotaciones<span class="sc">$</span>date))</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(fecha)</span></code></pre></div>
<p>Con la función <code>rank.teams</code> creamos un ranking de los equipos de acuerdo a su desempeño (anotaciones).</p>
<p>La función <code>rank.teams</code> ajusta un modelo linear que estima la fuerza de ataque y defensa de los equipos.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>ranking <span class="ot">&lt;-</span> <span class="fu">rank.teams</span>(</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">scores=</span>anotaciones, </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">teams=</span>equipos, </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.date=</span><span class="fu">max</span>(fecha), </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">min.date=</span><span class="fu">min</span>(fecha), </span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">date.format=</span><span class="st">&quot;%Y-%m-%d&quot;</span>)</span></code></pre></div>
<p>Estimar las probabilidades de los eventos que el equipo de casa gane, que el equipo vistante gane o que sea un empate para la última fecha del vector fecha.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>prediccion <span class="ot">=</span> <span class="fu">predict</span>(</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>    ranking, </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> fecha[n], </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.date=</span><span class="fu">max</span>(fecha), </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">min.date=</span><span class="fu">min</span>(fecha)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>Predicted Match Results for 2017-08-18 to 2020-07-19
Model based on data from 2017-08-18 to 2020-07-19
---------------------------------------------
2020-07-19 Alaves vs Barcelona, HW 8%, AW 77%, T 15%, pred score 0.7-2.5  actual: AW (0-5)
2020-07-19 Valladolid vs Betis, HW 30%, AW 42%, T 28%, pred score 1-1.2  actual: HW (2-0)
2020-07-19 Villarreal vs Eibar, HW 46%, AW 29%, T 25%, pred score 1.6-1.2  actual: HW (4-0)
2020-07-19 Ath Madrid vs Sociedad, HW 53%, AW 20%, T 27%, pred score 1.5-0.8  actual: T (1-1)
2020-07-19 Espanol vs Celta, HW 32%, AW 41%, T 27%, pred score 1.1-1.3  actual: T (0-0)
2020-07-19 Granada vs Ath Bilbao, HW 43%, AW 28%, T 29%, pred score 1.2-1  actual: HW (4-0)
2020-07-19 Leganes vs Real Madrid, HW 13%, AW 66%, T 21%, pred score 0.7-1.9  actual: T (2-2)
2020-07-19 Levante vs Getafe, HW 25%, AW 47%, T 28%, pred score 0.9-1.4  actual: HW (1-0)
2020-07-19 Osasuna vs Mallorca, HW 47%, AW 28%, T 25%, pred score 1.6-1.2  actual: T (2-2)
2020-07-19 Sevilla vs Valencia, HW 34%, AW 39%, T 27%, pred score 1.2-1.3  actual: HW (1-0)</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Diez partidos se jugaron en la última fecha. </span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>df.pred.vs.real <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fecha=</span>prediccion<span class="sc">$</span>scores<span class="sc">$</span>date, </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred.HW=</span>prediccion<span class="sc">$</span>scores<span class="sc">$</span>home.win, </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred.AW=</span>prediccion<span class="sc">$</span>scores<span class="sc">$</span>away.win, </span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred.Empate=</span>prediccion<span class="sc">$</span>scores<span class="sc">$</span>tie,</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Real.HomeScore=</span>prediccion<span class="sc">$</span>scores<span class="sc">$</span>home.score, </span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Real.AwayScore=</span>prediccion<span class="sc">$</span>scores<span class="sc">$</span>away.score,</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">filter</span>(</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>        anotaciones, </span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>        anotaciones<span class="sc">$</span>date<span class="sc">==</span>fecha[n]), </span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>        home.team, </span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>        away.team))</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>df.pred.vs.real</span></code></pre></div>
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="header">
<th>fecha</th>
<th>pred.HW</th>
<th>pred.AW</th>
<th>pred.Empate</th>
<th>Real.HomeScore</th>
<th>Real.AwayScore</th>
<th>home.team</th>
<th>away.team</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2020-07-19</td>
<td>8.552</td>
<td>76.501</td>
<td>14.947</td>
<td>0</td>
<td>5</td>
<td>Alaves</td>
<td>Barcelona</td>
</tr>
<tr class="even">
<td>2020-07-19</td>
<td>29.800</td>
<td>41.778</td>
<td>28.422</td>
<td>2</td>
<td>0</td>
<td>Valladolid</td>
<td>Betis</td>
</tr>
<tr class="odd">
<td>2020-07-19</td>
<td>46.224</td>
<td>28.589</td>
<td>25.187</td>
<td>4</td>
<td>0</td>
<td>Villarreal</td>
<td>Eibar</td>
</tr>
<tr class="even">
<td>2020-07-19</td>
<td>53.794</td>
<td>19.876</td>
<td>26.330</td>
<td>1</td>
<td>1</td>
<td>Ath Madrid</td>
<td>Sociedad</td>
</tr>
<tr class="odd">
<td>2020-07-19</td>
<td>31.833</td>
<td>41.039</td>
<td>27.128</td>
<td>0</td>
<td>0</td>
<td>Espanol</td>
<td>Celta</td>
</tr>
<tr class="even">
<td>2020-07-19</td>
<td>43.032</td>
<td>28.552</td>
<td>28.416</td>
<td>4</td>
<td>0</td>
<td>Granada</td>
<td>Ath Bilbao</td>
</tr>
<tr class="odd">
<td>2020-07-19</td>
<td>12.988</td>
<td>66.034</td>
<td>20.978</td>
<td>2</td>
<td>2</td>
<td>Leganes</td>
<td>Real Madrid</td>
</tr>
<tr class="even">
<td>2020-07-19</td>
<td>25.493</td>
<td>46.957</td>
<td>27.550</td>
<td>1</td>
<td>0</td>
<td>Levante</td>
<td>Getafe</td>
</tr>
<tr class="odd">
<td>2020-07-19</td>
<td>47.476</td>
<td>27.966</td>
<td>24.558</td>
<td>2</td>
<td>2</td>
<td>Osasuna</td>
<td>Mallorca</td>
</tr>
<tr class="even">
<td>2020-07-19</td>
<td>34.575</td>
<td>38.845</td>
<td>26.580</td>
<td>1</td>
<td>0</td>
<td>Sevilla</td>
<td>Valencia</td>
</tr>
</tbody>
</table>
<p>De los diez partidos que se jugaron en la última fecha, el equipo de casa ganó en cinco ocasiones.</p>
<h3 id="contra-los-pronósticos-de-probabilidades">Contra los pronósticos de probabilidades:</h3>
<ol type="1">
<li>El Valldolid (casa) le ganó al Betis (visitante)</li>
<li>Ath Madrid (casa) y Sociedad (visitante) quedaron empates</li>
<li>Leganes (casa) y Real Madrid (visitante) quedaron empates</li>
</ol>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ranking)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(prediccion)</span></code></pre></div>
<pre><code>List of 8
 $ fit            :List of 1
  ..$ cluster.1:List of 30
  .. ..$ coefficients     : Named num [1:51] 0.0589 0.1343 0.4036 0.9308 0.3613 ...
  .. .. ..- attr(*, &quot;names&quot;)= chr [1:51] &quot;attackAlaves&quot; &quot;attackAth Bilbao&quot; &quot;attackAth Madrid&quot; &quot;attackBarcelona&quot; ...
  .. ..$ residuals        : Named num [1:2280] 0.0603 -0.5303 0.4504 2.3139 -0.3108 ...
  .. .. ..- attr(*, &quot;names&quot;)= chr [1:2280] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
  .. ..$ fitted.values    : Named num [1:2280] 0.943 2.129 1.379 0.604 1.451 ...
  .. .. ..- attr(*, &quot;names&quot;)= chr [1:2280] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
  .. ..$ effects          : Named num [1:2280] -0.167 -1.109 -4.873 -14.968 -3.842 ...
  .. .. ..- attr(*, &quot;names&quot;)= chr [1:2280] &quot;attackAlaves&quot; &quot;attackAth Bilbao&quot; &quot;attackAth Madrid&quot; &quot;attackBarcelona&quot; ...
  .. ..$ R                : num [1:51, 1:51] -10.6 0 0 0 0 ...
  ...
  .. ..$ weights          : Named num [1:2280] 0.943 2.129 1.379 0.604 1.451 ...
  .. .. ..- attr(*, &quot;names&quot;)= chr [1:2280] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
 $ scores         :&#39;data.frame&#39;:    1140 obs. of  7 variables:
  ..$ date          : Date[1:1140], format: &quot;2017-08-18&quot; &quot;2017-08-18&quot; &quot;2017-08-19&quot; ...
  ..$ home.team     : chr [1:1140] &quot;Leganes&quot; &quot;Valencia&quot; &quot;Celta&quot; &quot;Girona&quot; ...
  ..$ home.score    : num [1:1140] 1 1 2 2 1 0 2 0 1 0 ...
  ..$ away.team     : chr [1:1140] &quot;Alaves&quot; &quot;Las Palmas&quot; &quot;Sociedad&quot; &quot;Ath Madrid&quot; ...
  ..$ away.score    : num [1:1140] 0 0 3 2 1 0 0 3 0 1 ...
  ..$ home.residuals: num [1:1140] 0.0568 -1.1292 0.621 1.3965 -0.451 ...
  ..$ away.residuals: num [1:1140] -0.963 -0.5386 1.2937 0.3915 0.0754 ...
 $ teams          :&#39;data.frame&#39;:    26 obs. of  1 variable:
  ..$ name: chr [1:26] &quot;Alaves&quot; &quot;Ath Bilbao&quot; &quot;Ath Madrid&quot; &quot;Barcelona&quot; ...
 $ max.date       : Date[1:1], format: &quot;2020-07-19&quot;
 $ min.date       : Date[1:1], format: &quot;2017-08-18&quot;
 $ time.weight.eta: num 0
 $ date.format    : chr &quot;%Y-%m-%d&quot;
...</code></pre>
<pre><code>&gt; str(prediccion)

List of 7
 $ scores        :&#39;data.frame&#39;: 10 obs. of  18 variables:
  ..$ date           : Date[1:10], format: &quot;2020-07-19&quot; &quot;2020-07-19&quot; &quot;2020-07-19&quot; ...
  ..$ home.team      : chr [1:10] &quot;Alaves&quot; &quot;Valladolid&quot; &quot;Villarreal&quot; &quot;Ath Madrid&quot; ...
  ..$ home.score     : num [1:10] 0 2 4 1 0 4 2 1 2 1
  ..$ away.team      : chr [1:10] &quot;Barcelona&quot; &quot;Betis&quot; &quot;Eibar&quot; &quot;Sociedad&quot; ...
  ..$ away.score     : num [1:10] 5 0 0 1 0 0 2 0 2 0
  ..$ home.residuals : num [1:10] -0.728 0.995 2.438 -0.469 -1.132 ...
  ..$ away.residuals : num [1:10] 2.464 -1.248 -1.172 0.219 -1.325 ...
  ..$ pred.home.score: num [1:10] 0.728 1.005 1.562 1.469 1.132 ...
  ..$ pred.away.score: num [1:10] 2.536 1.248 1.172 0.781 1.325 ...
  ..$ home.attack    : num [1:10] 0.0589 -0.0941 0.4597 0.4036 0.0378 ...
  ..$ home.defend    : num [1:10] 0 -0.1398 -0.0317 -0.6956 -0.0591 ...
  ..$ away.attack    : num [1:10] 0.931 0.361 0.191 0.448 0.341 ...
  ..$ away.defend    : num [1:10] -0.3769 0.0986 -0.0134 -0.0192 0.0859 ...
  ..$ home.win       : num [1:10] 8.55 29.8 46.22 53.79 31.83 ...
  ..$ away.win       : num [1:10] 76.5 41.8 28.6 19.9 41 ...
  ..$ tie            : num [1:10] 14.9 28.4 25.2 26.3 27.1 ...
  ..$ home.shutout   : num [1:10] 48.3 36.5 20.8 22.8 32.5 ...
  ..$ away.shutout   : num [1:10] 7.98 28.86 30.97 45.72 26.65 ...
 $ home.score    : Named num [1:10] 0.728 1.005 1.562 1.469 1.132 ...
  ..- attr(*, &quot;names&quot;)= chr [1:10] &quot;Alaves&quot; &quot;Valladolid&quot; &quot;Villarreal&quot; &quot;Ath Madrid&quot; ...
 $ away.score    : Named num [1:10] 2.536 1.248 1.172 0.781 1.325 ...
  ..- attr(*, &quot;names&quot;)= chr [1:10] &quot;Barcelona&quot; &quot;Betis&quot; &quot;Eibar&quot; &quot;Sociedad&quot; ...
 $ home.goals.sum: num [1:2] 11.7 17
 $ home.goals    : int [1:10, 1:100000] 0 0 1 1 0 1 1 0 0 1 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : chr [1:10] &quot;Alaves&quot; &quot;Valladolid&quot; &quot;Villarreal&quot; &quot;Ath Madrid&quot; ...
  .. ..$ : NULL
 $ away.goals.sum: num [1:2] 13.8 10
 $ away.goals    : int [1:10, 1:100000] 4 2 1 0 2 1 1 2 1 0 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : chr [1:10] &quot;Barcelona&quot; &quot;Betis&quot; &quot;Eibar&quot; &quot;Sociedad&quot; ...
  .. ..$ : NULL</code></pre>
<h2 id="postwork-6">PostWork 6</h2>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(&quot;ggfortify&quot;)</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TSstudio)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(&quot;TSstudio&quot;)</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>match.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/beduExpert/Programacion-R-Santander-2021/main/Sesion-06/Postwork/match.data.csv&quot;</span>, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>match.data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(match.data, <span class="at">sumagoles=</span><span class="fu">c</span>(match.data<span class="sc">$</span>home.score<span class="sc">+</span>match.data<span class="sc">$</span>away.score))</span></code></pre></div>
<p>Fijamos el formato de <code>date</code> y agregamos columna que indica mes y otra que indica mes y año.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>match.data <span class="ot">&lt;-</span> match.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date, <span class="st">&quot;%Y-%m-%d&quot;</span>), </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">mes=</span><span class="fu">months</span>(date),</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Ym =</span> <span class="fu">format</span>(date, <span class="st">&quot;%Y-%m&quot;</span>))</span></code></pre></div>
<p>Agrupamos por mes y sacamos el promedio de los goles. Con <code>n()</code> podemos sacar el número de partidos de cada mes.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>MES <span class="ot">&lt;-</span> match.data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(mes) <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_mes =</span> <span class="fu">mean</span>(sumagoles, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">n =</span> <span class="fu">n</span>())</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(MES)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th>mes</th>
<th>avg_mes</th>
<th>n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>April</td>
<td>2.74</td>
<td>476</td>
</tr>
<tr class="even">
<td>August</td>
<td>2.48</td>
<td>194</td>
</tr>
<tr class="odd">
<td>December</td>
<td>2.64</td>
<td>334</td>
</tr>
<tr class="even">
<td>February</td>
<td>2.65</td>
<td>417</td>
</tr>
<tr class="odd">
<td>January</td>
<td>2.83</td>
<td>416</td>
</tr>
<tr class="even">
<td>July</td>
<td>2.26</td>
<td>57</td>
</tr>
<tr class="odd">
<td>June</td>
<td>2.63</td>
<td>63</td>
</tr>
<tr class="even">
<td>March</td>
<td>2.66</td>
<td>399</td>
</tr>
<tr class="odd">
<td>May</td>
<td>2.94</td>
<td>307</td>
</tr>
<tr class="even">
<td>November</td>
<td>2.79</td>
<td>346</td>
</tr>
<tr class="odd">
<td>October</td>
<td>2.83</td>
<td>372</td>
</tr>
<tr class="even">
<td>September</td>
<td>2.68</td>
<td>419</td>
</tr>
</tbody>
</table>
<p>Creamos la serie de tiempo del promedio por mes de la suma de goles hasta diciembre de 2019</p>
<p>Primero solo nos quedamos con el periodo que nos interesa y quitamos los meses que no tienen registros en todos los años del periodo (junio y julio) Tambien quitamos los años que no tengan todos los meses (2010)</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>periodo <span class="ot">&lt;-</span> <span class="fu">subset</span>(match.data, (Ym <span class="sc">&gt;=</span> <span class="st">&quot;2010-08&quot;</span> <span class="sc">&amp;</span> Ym <span class="sc">&lt;=</span> <span class="st">&quot;2019-05&quot;</span>))</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>periodo <span class="ot">&lt;-</span> <span class="fu">subset</span>(periodo, (mes<span class="sc">!=</span> <span class="st">&quot;junio&quot;</span> <span class="sc">&amp;</span> mes<span class="sc">!=</span><span class="st">&quot;julio&quot;</span>))</span></code></pre></div>
<p>Ahora calculamos el promedio por mes por año del periodo que nos interesa</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>Ym.periodo <span class="ot">&lt;-</span> periodo <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Ym) <span class="sc">%&gt;%</span> </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_Ym =</span> <span class="fu">mean</span>(sumagoles, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">n =</span> <span class="fu">n</span>())</span></code></pre></div>
<p>Ordenamos el dataframe por fecha</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>Ym.periodo <span class="ot">&lt;-</span> Ym.periodo[<span class="fu">order</span>(Ym.periodo<span class="sc">$</span>Ym), ]</span></code></pre></div>
<p>Creamos la serie de tiempo sólo para el periodo de tiempo con los mismos meses. Se inicia en Agosto del 2010 y termina en mayo de 2019 para tener temporadas completas</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>(golesMensuales.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Ym.periodo<span class="sc">$</span>avg_Ym,<span class="at">start =</span><span class="fu">c</span>(<span class="dv">2010</span>,<span class="dv">8</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2019</span>,<span class="dv">05</span>), <span class="at">frequency =</span> <span class="dv">10</span>))</span></code></pre></div>
<pre><code>Time Series:
Start = c(2010, 8) 
End = c(2019, 5) 
Frequency = 10 
 [1] 2.200000 2.425000 3.025641 2.902439 2.733333 3.000000 2.325000 2.400000 2.930233 2.957447
[11] 3.000000 2.525000 2.420000 2.833333 2.900000 2.550000 3.050000 2.981818 2.854545 2.700000
[21] 3.000000 2.871795 2.838710 2.829268 2.794872 3.025000 2.750000 2.657895 3.023810 2.725000
[31] 3.800000 2.920000 2.711111 2.850000 3.166667 3.125000 2.902439 2.500000 2.474576 2.769231
[41] 2.387097 2.400000 2.650000 2.903226 2.631579 2.400000 2.555556 2.780488 2.200000 2.633333
[51] 3.225000 1.750000 2.650000 3.055556 2.441176 2.435897 3.204082 2.714286 3.025000 2.727273
[61] 2.880000 2.850000 2.878049 3.384615 2.600000 2.862069 2.675000 2.880952 2.948718 2.985294
[71] 3.250000 2.300000 2.800000 2.914286 3.033333 2.128205 3.200000 2.604167 2.513514 2.296296
[81] 3.312500 2.260870 2.644444 2.375000 2.709677 2.526316 2.756098 2.300000</code></pre>
<p>Graficamos la serie de tiempo</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ts_info</span>(golesMensuales.ts)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">stl</span>(golesMensuales.ts, <span class="at">s.window =</span> <span class="st">&quot;periodic&quot;</span>), <span class="at">ts.colour=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p align="center">
<img src="https://github.com/AngelicaDC/Postworks_BEDU/blob/main/img/pw8_serie.png?raw=true" />
</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Descomponemos la serie</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>(golesMensuales.decom.A <span class="ot">&lt;-</span> <span class="fu">decompose</span>(golesMensuales.ts))</span></code></pre></div>
<pre><code>$x
Time Series:
Start = c(2010, 8) 
End = c(2019, 5) 
Frequency = 10 
 [1] 2.200000 2.425000 3.025641 2.902439 2.733333 3.000000 2.325000 2.400000
...
[81] 3.312500 2.260870 2.644444 2.375000 2.709677 2.526316 2.756098 2.300000

$seasonal
Time Series:
Start = c(2010, 8) 
End = c(2019, 5) 
Frequency = 10 
 [1]  0.34240116 -0.27944922 -0.06718738  0.17684590  0.01273685 -0.08336467
...
[85]  0.01273685 -0.08336467  0.05269610 -0.08670444

$trend
Time Series:
Start = c(2010, 8) 
End = c(2019, 5) 
Frequency = 10 
 [1]       NA       NA       NA       NA       NA 2.729909 2.774909 2.749627
...
[81] 2.624373 2.622083 2.584680       NA       NA       NA       NA       NA

$random
Time Series:
Start = c(2010, 8) 
End = c(2019, 5) 
Frequency = 10 
 [1]           NA           NA           NA           NA           NA
 [6]  0.353455397 -0.502605378 -0.262922780  0.239019418  0.279976429
...
[81]  0.345726004 -0.081764466  0.126952031           NA           NA
[86]           NA           NA           NA

$figure
 [1]  0.34240116 -0.27944922 -0.06718738  0.17684590  0.01273685 -0.08336467
 [7]  0.05269610 -0.08670444 -0.02467675 -0.04329756

$type
[1] &quot;additive&quot;

attr(,&quot;class&quot;)
[1] &quot;decomposed.ts&quot;</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(golesMensuales.decom.A)</span></code></pre></div>
<pre><code>List of 6
 $ x       : Time-Series [1:88] from 2011 to 2019: 2.2 2.42 3.03 2.9 2.73 ...
 $ seasonal: Time-Series [1:88] from 2011 to 2019: 0.3424 -0.2794 -0.0672 0.1768 0.0127 ...
 $ trend   : Time-Series [1:88] from 2011 to 2019: NA NA NA NA NA ...
 $ random  : Time-Series [1:88] from 2011 to 2019: NA NA NA NA NA ...
 $ figure  : num [1:10] 0.3424 -0.2794 -0.0672 0.1768 0.0127 ...
 $ type    : chr &quot;additive&quot;
 - attr(*, &quot;class&quot;)= chr &quot;decomposed.ts&quot;</code></pre>
<p>Juntamos la serie de tiempo mas su componente estacional para graficarlas juntas</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">cbind</span>(<span class="at">Goles_Mes=</span>golesMensuales.ts, <span class="at">Comp_Estacional=</span>golesMensuales.decom.A<span class="sc">$</span>seasonal)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ts_plot</span>(df,</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&quot;Promedio de Goles por Mes&quot;</span>,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">Xtitle =</span> <span class="st">&quot;Tiempo</span><span class="sc">\n</span><span class="st"> Agosto de 2010 a Mayo de 2019,</span><span class="sc">\n</span><span class="st"> exceptuando los meses de junio y julio&quot;</span>,</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">Ytitle =</span> <span class="cn">NULL</span>,</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">line.mode =</span>  <span class="st">&quot;lines+markers&quot;</span>,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">Xgrid =</span> <span class="cn">TRUE</span>,</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">Ygrid =</span> <span class="cn">TRUE</span>,</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">&quot;multiple&quot;</span>)</span></code></pre></div>
<p align="center">
<img src="https://github.com/AngelicaDC/Postworks_BEDU/blob/main/img/pw6_ts.png?raw=true" />
</p>
<h2 id="postwork-7-1">Postwork 7</h2>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mongolite)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span><span class="fu">mongo</span>(</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">collection =</span> <span class="st">&quot;match&quot;</span>,</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">db =</span> <span class="st">&quot;match_games&quot;</span>,</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">url =</span> <span class="st">&quot;mongodb+srv://introabd:facil001@cluster0.blz9f.mongodb.net/testt&quot;</span>,</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span> <span class="fu">ssl_options</span>()</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> m<span class="sc">$</span><span class="fu">find</span>()</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>num.registros <span class="ot">=</span> m<span class="sc">$</span><span class="fu">count</span>()</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;El número total de registros en la colección match es&quot;</span>,num.registros))</span></code></pre></div>
<blockquote>
<p>El número total de registros en la colección match es 3800</p>
</blockquote>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>consulta <span class="ot">=</span> m<span class="sc">$</span><span class="fu">find</span>(<span class="st">&#39;{&quot;date&quot;:&quot;2015-12-20&quot;, &quot;home.team&quot;:&quot;Real Madrid&quot;}&#39;</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>diferencia<span class="ot">=</span><span class="fu">as.numeric</span>(consulta<span class="sc">$</span>home<span class="sc">$</span>score)<span class="sc">-</span><span class="fu">as.numeric</span>(consulta<span class="sc">$</span>away<span class="sc">$</span>score)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;El equipo Real Madrid goleó a su contrincante&quot;</span>,consulta<span class="sc">$</span>away<span class="sc">$</span>team,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;con una diferencia de&quot;</span>,diferencia,<span class="st">&quot;goles&quot;</span>))</span></code></pre></div>
<blockquote>
<p>El equipo Real Madrid goleó a su contrincante Vallecano con una diferencia de 8 goles</p>
</blockquote>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span><span class="fu">disconnect</span>()</span></code></pre></div>
<h2 id="postwork-8">Postwork 8</h2>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shinydashboard)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fluidPage</span>(</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">dashboardPage</span>(<span class="at">skin =</span> <span class="st">&quot;purple&quot;</span>,</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">dashboardHeader</span>(<span class="at">title =</span> <span class="st">&quot;PostWork 8&quot;</span>),</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">dashboardSidebar</span>(</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">sidebarMenu</span>(</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">menuItem</span>(<span class="st">&quot;Grafica de Barras&quot;</span>, <span class="at">tabName =</span> <span class="st">&quot;Barras&quot;</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">&quot;bar-chart-o&quot;</span>)),</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">menuItem</span>(<span class="st">&quot;Graficas de Postwork 3&quot;</span>, <span class="at">tabName =</span> <span class="st">&quot;PW3&quot;</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">&quot;area-chart&quot;</span>)),</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">menuItem</span>(<span class="st">&quot;Match Data - DataTable&quot;</span>, <span class="at">tabName =</span> <span class="st">&quot;data_table&quot;</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">&quot;table&quot;</span>)),</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">menuItem</span>(<span class="st">&quot;Factores de Ganancia&quot;</span>, <span class="at">tabName =</span> <span class="st">&quot;Fact&quot;</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">&quot;line-chart&quot;</span>))</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>                          )</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>                      ),</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">dashboardBody</span>(</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># Aditivos :D</span></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">singleton</span>(tags<span class="sc">$</span><span class="fu">head</span>(tags<span class="sc">$</span><span class="fu">script</span>(<span class="at">src=</span><span class="st">&#39;script.js&#39;</span>))),</span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">singleton</span>(tags<span class="sc">$</span><span class="fu">head</span>(tags<span class="sc">$</span><span class="fu">link</span>(<span class="at">rel=</span><span class="st">&quot;stylesheet&quot;</span>, <span class="at">type =</span> <span class="st">&quot;text/css&quot;</span>, <span class="at">href =</span> <span class="st">&quot;styles.css&quot;</span>))),</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>                          </span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tabItems</span>(</span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>                              <span class="co"># Graficas de Barras</span></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">tabItem</span>(<span class="at">tabName =</span> <span class="st">&quot;Barras&quot;</span>,</span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">fluidRow</span>(</span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">box</span>(<span class="at">width =</span> <span class="cn">NULL</span>, <span class="at">height =</span> <span class="cn">NULL</span>,</span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">titlePanel</span>(<span class="st">&quot;Grafica de Barras de Goles en contra y a favor&quot;</span>), </span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">selectInput</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;Seleccione el valor de X&quot;</span>,</span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a>                                                          <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">&quot;home.score&quot;</span>,<span class="st">&quot;away.score&quot;</span>)),</span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">plotOutput</span>(<span class="st">&quot;output_plot&quot;</span>)</span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a>                                          )</span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a>                                      )</span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a>                              </span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true" tabindex="-1"></a>                              <span class="co"># Graficas obtenidas en PostWork3</span></span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">tabItem</span>(<span class="at">tabName =</span> <span class="st">&quot;PW3&quot;</span>, </span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">fluidRow</span>(</span>
<span id="cb97-37"><a href="#cb97-37" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">box</span>(<span class="at">width =</span> <span class="cn">NULL</span>, <span class="at">height =</span> <span class="cn">NULL</span>,</span>
<span id="cb97-38"><a href="#cb97-38" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">titlePanel</span>(<span class="fu">h3</span>(<span class="st">&quot;Graficos obtenidos en Postwork 3&quot;</span>)),</span>
<span id="cb97-39"><a href="#cb97-39" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">img</span>(<span class="at">src =</span> <span class="st">&quot;Barras.png&quot;</span>, <span class="at">height =</span> <span class="dv">450</span>, <span class="at">width =</span> <span class="dv">650</span>),</span>
<span id="cb97-40"><a href="#cb97-40" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">img</span>(<span class="at">src =</span>  <span class="st">&quot;ProbConjunta.png&quot;</span>, <span class="at">height =</span> <span class="dv">450</span>, <span class="at">width =</span> <span class="dv">650</span>)</span>
<span id="cb97-41"><a href="#cb97-41" aria-hidden="true" tabindex="-1"></a>                                          )</span>
<span id="cb97-42"><a href="#cb97-42" aria-hidden="true" tabindex="-1"></a>                                      )</span>
<span id="cb97-43"><a href="#cb97-43" aria-hidden="true" tabindex="-1"></a>                              ),</span>
<span id="cb97-44"><a href="#cb97-44" aria-hidden="true" tabindex="-1"></a>                              <span class="co">#Match Data en DataTable</span></span>
<span id="cb97-45"><a href="#cb97-45" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">tabItem</span>(<span class="at">tabName =</span> <span class="st">&quot;data_table&quot;</span>,</span>
<span id="cb97-46"><a href="#cb97-46" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">fluidRow</span>(</span>
<span id="cb97-47"><a href="#cb97-47" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">box</span>(<span class="at">width =</span> <span class="cn">NULL</span>, <span class="at">height =</span> <span class="cn">NULL</span>,</span>
<span id="cb97-48"><a href="#cb97-48" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">titlePanel</span>(<span class="fu">h3</span>(<span class="st">&quot;Match Data&quot;</span>)),</span>
<span id="cb97-49"><a href="#cb97-49" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">dataTableOutput</span> (<span class="st">&quot;dataTable&quot;</span>)</span>
<span id="cb97-50"><a href="#cb97-50" aria-hidden="true" tabindex="-1"></a>                                          )</span>
<span id="cb97-51"><a href="#cb97-51" aria-hidden="true" tabindex="-1"></a>                                      )</span>
<span id="cb97-52"><a href="#cb97-52" aria-hidden="true" tabindex="-1"></a>                              ), </span>
<span id="cb97-53"><a href="#cb97-53" aria-hidden="true" tabindex="-1"></a>                              <span class="co">#Factores de Ganacia Maximos y promedios Obtenidos en momios.r</span></span>
<span id="cb97-54"><a href="#cb97-54" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">tabItem</span>(<span class="at">tabName =</span> <span class="st">&quot;Fact&quot;</span>,</span>
<span id="cb97-55"><a href="#cb97-55" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">fluidRow</span>(</span>
<span id="cb97-56"><a href="#cb97-56" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">box</span>(<span class="at">width =</span> <span class="cn">NULL</span>, <span class="at">height =</span> <span class="cn">NULL</span>,</span>
<span id="cb97-57"><a href="#cb97-57" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">titlePanel</span>(<span class="fu">h3</span>(<span class="st">&quot;Factores de Ganancia&quot;</span>)),</span>
<span id="cb97-58"><a href="#cb97-58" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">h4</span>(<span class="st">&quot;Factor de Ganancia Maximos:&quot;</span>),</span>
<span id="cb97-59"><a href="#cb97-59" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">img</span>(<span class="at">src =</span> <span class="st">&quot;Escenario_MomiosMax.png&quot;</span>, <span class="at">height =</span> <span class="dv">450</span>, <span class="at">width =</span> <span class="dv">750</span>),</span>
<span id="cb97-60"><a href="#cb97-60" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">h4</span>(<span class="st">&quot;Factor de Ganancia Promedios:&quot;</span>),</span>
<span id="cb97-61"><a href="#cb97-61" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">img</span>(<span class="at">src =</span> <span class="st">&quot;Momios_Promedio.png&quot;</span>, <span class="at">height =</span> <span class="dv">450</span>, <span class="at">width =</span> <span class="dv">750</span>)</span>
<span id="cb97-62"><a href="#cb97-62" aria-hidden="true" tabindex="-1"></a>                                          )</span>
<span id="cb97-63"><a href="#cb97-63" aria-hidden="true" tabindex="-1"></a>                                      )</span>
<span id="cb97-64"><a href="#cb97-64" aria-hidden="true" tabindex="-1"></a>                              )</span>
<span id="cb97-65"><a href="#cb97-65" aria-hidden="true" tabindex="-1"></a>                          )</span>
<span id="cb97-66"><a href="#cb97-66" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb97-67"><a href="#cb97-67" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb97-68"><a href="#cb97-68" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb97-69"><a href="#cb97-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-70"><a href="#cb97-70" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb97-71"><a href="#cb97-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(ggplot2)</span>
<span id="cb97-72"><a href="#cb97-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-73"><a href="#cb97-73" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/AngelicaDC/Postworks_BEDU/main/postworks/postWork8%20-%20Ignacio/PostWork8/data/match.data.csv&quot;</span>)</span>
<span id="cb97-74"><a href="#cb97-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-75"><a href="#cb97-75" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>output_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb97-76"><a href="#cb97-76" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>(data, <span class="fu">aes_string</span>(<span class="at">x =</span> input<span class="sc">$</span>variable, <span class="at">fill =</span> <span class="st">&quot;FTR&quot;</span>)) <span class="sc">+</span></span>
<span id="cb97-77"><a href="#cb97-77" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb97-78"><a href="#cb97-78" aria-hidden="true" tabindex="-1"></a>            <span class="fu">facet_wrap</span>(<span class="fu">as.factor</span>(data<span class="sc">$</span>away.team))<span class="sc">+</span></span>
<span id="cb97-79"><a href="#cb97-79" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ggtitle</span>(<span class="st">&quot;Goles a favor y en contra&quot;</span>)<span class="sc">+</span></span>
<span id="cb97-80"><a href="#cb97-80" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">&quot;N° de Goles&quot;</span>)}, <span class="at">width =</span> <span class="st">&quot;auto&quot;</span> ,<span class="at">height =</span> <span class="dv">650</span>)</span>
<span id="cb97-81"><a href="#cb97-81" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>dataTable <span class="ot">&lt;-</span> <span class="fu">renderDataTable</span>({data},<span class="at">options =</span> <span class="fu">list</span>(<span class="at">aLengthMenu =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">50</span>), <span class="at">iDisplayLength =</span> <span class="dv">20</span>))</span>
<span id="cb97-82"><a href="#cb97-82" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb97-83"><a href="#cb97-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-84"><a href="#cb97-84" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(ui, server)</span></code></pre></div>
El codigo anterior se encuetra disponible en el <a href="https://github.com/AngelicaDC/Postworks_BEDU">siguiente repositorio de Github</a>.
<p align="center">
<img src="https://github.com/AngelicaDC/Postworks_BEDU/blob/main/img/github.png?raw=true" />
</p>
<blockquote>
<p><em>NOTA</em>: El código fuente que se muestra en este documento se encuentra <a href="postWorks_1eraEtapa.R">aquí</a>.</p>
</blockquote>
<p align="center">
<img width="300" src="https://media.giphy.com/media/3oEdva9BUHPIs2SkGk/giphy.gif" />
</p>